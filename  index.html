
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>勾股定理AR探索 - 课本第86页</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            overflow: hidden;
            height: 100vh;
            touch-action: manipulation;
        }
        
        .container {
            position: relative;
            width: 100%;
            height: 100vh;
        }
        
        canvas {
            display: block;
            width: 100%;
            height: 100%;
            cursor: grab;
        }
        
        canvas:active { cursor: grabbing; }
        
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.8);
            padding: 15px;
            backdrop-filter: blur(10px);
            z-index: 1000;
            text-align: center;
        }
        
        .data-panel {
            position: fixed;
            top: 80px;
            right: 20px;
            background: rgba(0,0,0,0.85);
            padding: 20px;
            border-radius: 15px;
            min-width: 280px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.2);
            z-index: 1000;
        }
        
        .data-title {
            text-align: center;
            margin-bottom: 15px;
            font-size: 18px;
            color: #4CAF50;
            font-weight: bold;
        }
        
        .data-row {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            font-size: 16px;
            align-items: center;
        }
        
        .color-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        .red-dot { background: #FF5722; }
        .blue-dot { background: #2196F3; }
        .green-dot { background: #4CAF50; }
        
        .equation {
            text-align: center;
            margin: 15px 0;
            padding: 12px;
            background: rgba(76,175,80,0.2);
            border-radius: 8px;
            font-weight: bold;
            font-size: 16px;
            border: 2px solid #4CAF50;
        }
        
        .instructions {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0,0,0,0.85);
            padding: 15px;
            border-radius: 10px;
            max-width: 320px;
            backdrop-filter: blur(10px);
            z-index: 1000;
        }
        
        .btn-group {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .btn {
            display: block;
            margin: 8px 0;
            padding: 12px 24px;
            background: #FF5722;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            text-align: center;
            min-width: 140px;
        }
        
        .btn:hover {
            background: #E64A19;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255,87,34,0.3);
        }
        
        .btn-secondary {
            background: #2196F3;
        }
        
        .btn-secondary:hover {
            background: #1976D2;
        }
        
        .status {
            font-size: 12px;
            opacity: 0.8;
            margin-top: 10px;
            text-align: center;
        }
        
        @media (max-width: 768px) {
            .data-panel {
                right: 10px;
                top: 70px;
                min-width: 250px;
                padding: 15px;
            }
            
            .instructions {
                left: 10px;
                bottom: 10px;
                max-width: 280px;
            }
            
            .btn-group {
                right: 10px;
                bottom: 10px;
            }
            
            .btn {
                padding: 10px 20px;
                font-size: 12px;
                min-width: 120px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 页头 -->
        <div class="header">
            <h2>勾股定理AR探索 - 数学课本第86页</h2>
        </div>
        
        <!-- 画布 -->
        <canvas id="canvas"></canvas>
        
        <!-- 数据面板 -->
        <div class="data-panel">
            <div class="data-title">实时数据验证</div>
            <div class="data-row">
                <span><span class="color-dot red-dot"></span>红色面积 (c²):</span>
                <span id="redArea">25</span>
            </div>
            <div class="data-row">
                <span><span class="color-dot blue-dot"></span>蓝色面积 (a²):</span>
                <span id="blueArea">9</span>
            </div>
            <div class="data-row">
                <span><span class="color-dot green-dot"></span>绿色面积 (b²):</span>
                <span id="greenArea">16</span>
            </div>
            <div class="equation" id="equation">
                25 = 9 + 16 ✓
            </div>
            <div class="status">
                记录数据: <span id="recordCount">0</span>/3 组
            </div>
        </div>
        
        <!-- 操作说明 -->
        <div class="instructions">
            <h4>操作说明</h4>
            <p>• 拖拽黄色顶点改变三角形</p>
            <p>• 观察三个正方形面积变化</p>
            <p>• 验证勾股定理: c² = a² + b²</p>
            <p>• 记录3组不同数据进行验证</p>
        </div>
        
        <!-- 按钮组 -->
        <div class="btn-group">
            <button class="btn" onclick="randomizeTriangle()">随机三角形</button>
            <button class="btn btn-secondary" onclick="resetTriangle()">重置为3-4-5</button>
            <button class="btn" onclick="captureData()">记录当前数据</button>
        </div>
    </div>

    <script>
        class PythagoreanTheorem {
            constructor() {
                this.canvas = document.getElementById('canvas');
                this.ctx = this.canvas.getContext('2d');
                this.resizeCanvas();
                
                // 初始顶点位置 (3-4-5直角三角形)
                this.vertices = {
                    A: { x: 150, y: 400 },  // 直角顶点
                    B: { x: 450, y: 400 },  // 底边另一端 (距离A为300像素，对应边长5)
                    C: { x: 150, y: 160 }   // 高点 (距离A为240像素，对应边长4)
                };
                
                this.dragging = null;
                this.recordedData = [];
                this.scale = 60; // 每单位长度对应的像素数
                
                this.setupEventListeners();
                this.animate();
            }
            
            resizeCanvas() {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
            }
            
            setupEventListeners() {
                window.addEventListener('resize', () => {
                    this.resizeCanvas();
                });
                
                // 鼠标事件
                this.canvas.addEventListener('mousedown', (e) => this.handleStart(e));
                this.canvas.addEventListener('mousemove', (e) => this.handleMove(e));
                this.canvas.addEventListener('mouseup', () => this.handleEnd());
                
                // 触摸事件
                this.canvas.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    this.handleStart(e.touches[0]);
                });
                this.canvas.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    this.handleMove(e.touches[0]);
                });
                this.canvas.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    this.handleEnd();
                });
            }
            
            getEventPos(e) {
                const rect = this.canvas.getBoundingClientRect();
                return {
                    x: e.clientX - rect.left,
                    y: e.clientY - rect.top
                };
            }
            
            handleStart(e) {
                const pos = this.getEventPos(e);
                
                // 检查是否点击在顶点上
                for (const [key, vertex] of Object.entries(this.vertices)) {
                    const dist = Math.sqrt((pos.x - vertex.x) ** 2 + (pos.y - vertex.y) ** 2);
                    if (dist < 25) {
                        this.dragging = key;
                        break;
                    }
                }
            }
            
            handleMove(e) {
                if (!this.dragging) return;
                
                const pos = this.getEventPos(e);
                
                // 限制拖拽范围
                pos.x = Math.max(50, Math.min(this.canvas.width - 50, pos.x));
                pos.y = Math.max(50, Math.min(this.canvas.height - 50, pos.y));
                
                // 更新顶点位置，保持直角约束
                if (this.dragging === 'A') {
                    // A是直角顶点，可以自由移动，但要调整B和C保持直角
                    const deltaX = pos.x - this.vertices.A.x;
                    const deltaY = pos.y - this.vertices.A.y;
                    
                    this.vertices.A = pos;
                    this.vertices.B.x += deltaX;
                    this.vertices.B.y += deltaY;
                    this.vertices.C.x += deltaX;
                    this.vertices.C.y += deltaY;
                } else if (this.dragging === 'B') {
                    // B点移动，保持AB垂直于AC
                    this.vertices.B = pos;
                } else if (this.dragging === 'C') {
                    // C点移动，保持AC垂直于AB
                    this.vertices.C = pos;
                }
                
                this.updateUI();
            }
            
            handleEnd() {
                this.dragging = null;
            }
            
            calculateSides() {
                const A = this.vertices.A;
                const B = this.vertices.B;
                const C = this.vertices.C;
                
                // 计算实际距离并转换为数学单位
                const sideAB = Math.sqrt((B.x - A.x) ** 2 + (B.y - A.y) ** 2) / this.scale;
                const sideAC = Math.sqrt((C.x - A.x) ** 2 + (C.y - A.y) ** 2) / this.scale;
                const sideBC = Math.sqrt((C.x - B.x) ** 2 + (C.y - B.y) ** 2) / this.scale;
                
                return { 
                    AB: sideAB, 
                    AC: sideAC, 
                    BC: sideBC,
                    // 确保BC是斜边（最长边）
                    a: Math.min(sideAB, sideAC),
                    b: Math.max(sideAB, sideAC),
                    c: sideBC
                };
            }
            
            updateUI() {
                const sides = this.calculateSides();
                
                const areaA = Math.round(sides.a ** 2 * 100) / 100;
                const areaB = Math.round(sides.b ** 2 * 100) / 100;
                const areaC = Math.round(sides.c ** 2 * 100) / 100;
                
                document.getElementById('blueArea').textContent = areaA;
                document.getElementById('greenArea').textContent = areaB;
                document.getElementById('redArea').textContent = areaC;
                
                const difference = Math.abs(areaC - (areaA + areaB));
                const isValid = difference < 0.5;
                
                const equationElement = document.getElementById('equation');
                equationElement.innerHTML = `${areaC} = ${areaA} + ${areaB} ${isValid ? '✓' : '≈'}`;
                equationElement.style.background = isValid ? 'rgba(76,175,80,0.3)' : 'rgba(255,152,0,0.3)';
                equationElement.style.borderColor = isValid ? '#4CAF50' : '#FF9800';
            }
            
            draw() {
                // 清空画布
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                const A = this.vertices.A;
                const B = this.vertices.B;
                const C = this.vertices.C;
                const sides = this.calculateSides();
                
                // 绘制正方形
                this.drawSquare(A, B, '#2196F3', 0.4, '蓝色'); // AB边的正方形
                this.drawSquare(A, C, '#4CAF50', 0.4, '绿色'); // AC边的正方形
                this.drawSquare(B, C, '#FF5722', 0.4, '红色'); // BC边的正方形（斜边）
                
                // 绘制三角形
                this.ctx.strokeStyle = '#ffffff';
                this.ctx.lineWidth = 4;
                this.ctx.beginPath();
                this.ctx.moveTo(A.x, A.y);
                this.ctx.lineTo(B.x, B.y);
                this.ctx.lineTo(C.x, C.y);
                this.ctx.closePath();
                this.ctx.stroke();
                
                // 标记直角
                this.drawRightAngle(A, B, C);
                
                // 绘制顶点
                this.drawVertex(A, 'A', '#FFD700');
                this.drawVertex(B, 'B', '#FFD700');
                this.drawVertex(C, 'C', '#FFD700');
                
                // 绘制边长标注
                this.drawSideLabel(A, B, sides.AB.toFixed(1));
                this.drawSideLabel(A, C, sides.AC.toFixed(1));
                this.drawSideLabel(B, C, sides.BC.toFixed(1));
            }
            
            drawSquare(p1, p2, color, alpha, label) {
                const dx = p2.x - p1.x;
                const dy = p2.y - p1.y;
                
                // 计算垂直向量
                const perpX = -dy;
                const perpY = dx;
                
                // 正方形的四个顶点
                const vertices = [
                    { x: p1.x, y: p1.y },
                    { x: p2.x, y: p2.y },
                    { x: p2.x + perpX, y: p2.y + perpY },
                    { x: p1.x + perpX, y: p1.y + perpY }
                ];
                
                // 填充正方形
                this.ctx.fillStyle = color;
                this.ctx.globalAlpha = alpha;
                this.ctx.beginPath();
                this.ctx.moveTo(vertices[0].x, vertices[0].y);
                for (let i = 1; i < vertices.length; i++) {
                    this.ctx.lineTo(vertices[i].x, vertices[i].y);
                }
                this.ctx.closePath();
                this.ctx.fill();
                
                // 绘制边框
                this.ctx.globalAlpha = 1;
                this.ctx.strokeStyle = color;
                this.ctx.lineWidth = 2;
                this.ctx.stroke();
                
                // 在正方形中心添加标签
                const centerX = (vertices[0].x + vertices[2].x) / 2;
                const centerY = (vertices[0].y + vertices[2].y) / 2;
                
                this.ctx.fillStyle = '#ffffff';
                this.ctx.font = 'bold 14px Arial';
                this.ctx.textAlign = 'center';
                this.ctx.fillText(label, centerX, centerY + 5);
            }
            
            drawRightAngle(A, B, C) {
                const size = 20;
                const dx1 = B.x - A.x;
                const dy1 = B.y - A.y;
                const dx2 = C.x - A.x;
                const dy2 = C.y - A.y;
                
                const len1 = Math.sqrt(dx1 * dx1 + dy1 * dy1);
                const len2 = Math.sqrt(dx2 * dx2 + dy2 * dy2);
                
                const unitX1 = dx1 / len1;
                const unitY1 = dy1 / len1;
                const unitX2 = dx2 / len2;
                const unitY2 = dy2 / len2;
                
                const corner1 = { x: A.x + unitX1 * size, y: A.y + unitY1 * size };
                const corner2 = { x: A.x + unitX2 * size, y: A.y + unitY2 * size };
                const corner3 = { x: corner1.x + unitX2 * size, y: corner1.y + unitY2 * size };
                
                this.ctx.strokeStyle = '#ffffff';
                this.ctx.lineWidth = 2;
                this.ctx.beginPath();
                this.ctx.moveTo(corner1.x, corner1.y);
                this.ctx.lineTo(corner3.x, corner3.y);
                this.ctx.lineTo(corner2.x, corner2.y);
                this.ctx.stroke();
            }
            
            drawVertex(vertex, label, color) {
                // 绘制顶点圆圈
                this.ctx.fillStyle = color;
                this.ctx.beginPath();
                this.ctx.arc(vertex.x, vertex.y, 12, 0, 2 * Math.PI);
                this.ctx.fill();
                
                // 绘制边框
                this.ctx.strokeStyle = '#ffffff';
                this.ctx.lineWidth = 2;
                this.ctx.stroke();
                
                // 绘制标签
                this.ctx.fillStyle = '#000000';
                this.ctx.font = 'bold 12px Arial';
                this.ctx.textAlign = 'center';
                this.ctx.fillText(label, vertex.x, vertex.y + 4);
            }
            
            drawSideLabel(p1, p2, length) {
                const midX = (p1.x + p2.x) / 2;
                const midY = (p1.y + p2.y) / 2;
                
                this.ctx.fillStyle = '#ffffff';
                this.ctx.font = 'bold 14px Arial';
                this.ctx.textAlign = 'center';
                this.ctx.strokeStyle = '#000000';
                this.ctx.lineWidth = 3;
                this.ctx.strokeText(length, midX, midY - 10);
                this.ctx.fillText(length, midX, midY - 10);
            }
            
            animate() {
                this.draw();
                this.updateUI();
                requestAnimationFrame(() => this.animate());
            }
        }
        
        // 全局函数
        let demo;
        
        function randomizeTriangle() {
            const triangles = [
                { A: { x: 200, y: 350 }, B: { x: 500, y: 350 }, C: { x: 200, y: 130 } }, // 5-12-13
                { A: { x: 180, y: 400 }, B: { x: 420, y: 400 }, C: { x: 180, y: 160 } }, // 6-8-10
                { A: { x: 150, y: 380 }, B: { x: 570, y: 380 }, C: { x: 150, y: 140 } }, // 7-24-25
                { A: { x: 160, y: 360 }, B: { x: 520, y: 360 }, C: { x: 160, y: 120 } }  // 9-12-15
            ];
            
            const randomTriangle = triangles[Math.floor(Math.random() * triangles.length)];
            demo.vertices = randomTriangle;
        }
        
        function resetTriangle() {
            demo.vertices = {
                A: { x: 150, y: 400 },
                B: { x: 450, y: 400 },
                C: { x: 150, y: 160 }
            };
        }
        
        function captureData() {
            const sides = demo.calculateSides();
            const data = {
                timestamp: new Date().toLocaleString(),
                a: sides.a.toFixed(2),
                b: sides.b.toFixed(2),
                c: sides.c.toFixed(2),
                areaA: (sides.a ** 2).toFixed(2),
                areaB: (sides.b ** 2).toFixed(2),
                areaC: (sides.c ** 2).toFixed(2)
            };
            
            demo.recordedData.push(data);
            document.getElementById('recordCount').textContent = demo.recordedData.length;
            
            alert(`数据记录成功！\n边长: a=${data.a}, b=${data.b}, c=${data.c}\n面积: ${data.areaC} = ${data.areaA} + ${data.areaB}\n\n${demo.recordedData.length >= 3 ? '已记录3组数据，可以进行分析！' : `还需记录${3-demo.recordedData.length}组数据`}`);
            
            if (demo.recordedData.length >= 3) {
                showDataSummary();
            }
        }
        
        function showDataSummary() {
            let summary = "数据汇总报告：\n\n";
            demo.recordedData.forEach((data, index) => {
                summary += `第${index + 1}组: ${data.areaC} = ${data.areaA} + ${data.areaB}\n`;
            });
            summary += "\n结论：勾股定理在所有直角三角形中都成立！";
            
            setTimeout(() => alert(summary), 500);
        }
        
        // 初始化
        window.onload = function() {
            demo = new PythagoreanTheorem();
        };
    </script>
</body>
</html>
